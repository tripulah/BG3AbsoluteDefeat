game.actions.statusOverrides.AD_ACTION_ALLY_ASSIST = Action
{
    function()
        local source = GetStatusSource(me, "AD_ACTION_ALLY_ASSIST")
        --local ad = Dialog("AD_Automated_Ally_Help_01_72aabe9a-1aa4-5b01-50c8-dd6efd2dcb6c")
        if (source ~= nil and GetDistance2DTo(me, source) > 1.5) then
            local moveResult = MoveTo(source, MovementSpeed.Run, true, false, 1.0, 1.5, false)
            if moveResult ~= error.MovementError.None then
                DebugText(me, "Debug: MoveTo failed or run out of resources")
            end

            SteerTo(source)
        elseif (source ~= nil and not source.IsDead and HasActiveStatus(source, "AD_DEFEATED") or HasActiveStatus(source, "AD_DEFEATED_TEMP")) then
            SteerTo(source)
            -- assist dialog
            --StartAutomatedDialog(ad, false, me)
            UseSpell("Target_Help", source, nil, nil, nil, true, true, true)
            Sleep(3)
            RemoveStatus(me, "AD_ACTION_ALLY_ASSIST", source)
        elseif (source.IsDead) then
            RemoveStatus(me, "AD_ACTION_ALLY_ASSIST")
        end
    end,

    OnLeave = function()
        StopAnimation(me)
        RemoveStatus(me, "AD_ACTION_ALLY_ASSIST")
    end,

    Valid = function(node)
        return
            HasActiveStatus(me, "AD_ACTION_ALLY_ASSIST") and
            not me.IsInCombat
    end
    ,
    Priority = 485555
}